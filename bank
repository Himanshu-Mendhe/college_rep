DROP DATABASE IF EXISTS bank_db;
CREATE DATABASE bank_db;
USE bank_db;

CREATE TABLE branch_master (
    branch_id VARCHAR(10) PRIMARY KEY,
    bname VARCHAR(100)
);

CREATE TABLE manager_master (
    manager_id VARCHAR(10) PRIMARY KEY,
    manager_name VARCHAR(100)
);

CREATE TABLE employee_master (
    emp_id VARCHAR(10) PRIMARY KEY,
    e_name VARCHAR(100),
    branch_id VARCHAR(10),
    salary DECIMAL(10, 2),
    dept VARCHAR(50),
    manager_id VARCHAR(10),
    FOREIGN KEY (branch_id) REFERENCES branch_master(branch_id),
    FOREIGN KEY (manager_id) REFERENCES manager_master(manager_id) ON DELETE SET NULL
);

CREATE TABLE contact_details (
    contact_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_id VARCHAR(10),
    emailid VARCHAR(100),
    phnno VARCHAR(15),
    FOREIGN KEY (emp_id) REFERENCES employee_master(emp_id) ON DELETE SET NULL
);

CREATE TABLE emp_address_details (
    address_id INT PRIMARY KEY AUTO_INCREMENT,
    emp_id VARCHAR(10),
    street VARCHAR(100),
    city VARCHAR(50),
    state VARCHAR(50),
    FOREIGN KEY (emp_id) REFERENCES employee_master(emp_id) ON DELETE CASCADE
);

CREATE TABLE branch_address (
    address_id INT PRIMARY KEY AUTO_INCREMENT,
    branch_id VARCHAR(10),
    city VARCHAR(50),
    state VARCHAR(50),
    FOREIGN KEY (branch_id) REFERENCES branch_master(branch_id)
);

INSERT INTO branch_master (branch_id, bname) VALUES
('B1', 'Vadgaon'),
('B2', 'Kothrud'),
('B3', 'Hinjewadi'),
('B4', 'Admin-HQ'),
('B5', 'Shivajinagar');

INSERT INTO manager_master (manager_id, manager_name) VALUES
('M1', 'Ross Geller'),
('M2', 'Rachel Green'),
('M3', 'Joey Tribbiani'),
('M4', 'Phoebe Buffay'),
('M5', 'Monica Geller');

INSERT INTO employee_master (emp_id, e_name, branch_id, salary, dept, manager_id) VALUES
('E101', 'Chandler Bing', 'B1', 60000, 'Finance', 'M1'),
('E102', 'Monica Geller', 'B1', 70000, 'Operations', 'M1'),
('E103', 'Phoebe Buffay', 'B2', 55000, 'HR', 'M2'),
('E104', 'Gunther', 'B2', 40000, 'Support', 'M2'),
('E105', 'Mike Hannigan', 'B3', 80000, 'IT', 'M3'),
('E106', 'Janice', 'B4', 65000, 'Admin', NULL),
('E107', 'Richard Burke', 'B5', 120000, 'Management', 'M5');

INSERT INTO contact_details (emp_id, emailid, phnno) VALUES
('E101', 'chan@bank.com', '9876543210'),
('E102', 'mon@bank.com', '8765432109'),
('E104', 'gunther@bank.com', '7654321098'),
('E105', 'mike@bank.com', '6543210987'),
('E107', 'richard@bank.com', '5432109876');

INSERT INTO emp_address_details (emp_id, street, city, state) VALUES
('E101', '123 Main St', 'Pune', 'Maharashtra'),
('E102', '456 Oak Ave', 'Mumbai', 'Maharashtra'),
('E103', '789 Pine Ln', 'Pune', 'Maharashtra'),
('E104', '321 Elm Blvd', 'Pune', 'Maharashtra'),
('E105', '654 Maple Dr', 'Bangalore', 'Karnataka'),
('E107', '987 Cedar Rd', 'Mumbai', 'Maharashtra');

INSERT INTO branch_address (branch_id, city, state) VALUES
('B1', 'Pune', 'Maharashtra'),
('B2', 'Pune', 'Maharashtra'),
('B3', 'Pune', 'Maharashtra'),
('B4', 'Mumbai', 'Maharashtra'),
('B5', 'Mumbai', 'Maharashtra');

SELECT e.emp_id, e.e_name, e.dept, b.bname
FROM employee_master e
INNER JOIN branch_master b ON e.branch_id = b.branch_id
ORDER BY e.emp_id;

SELECT e.e_name, e.dept, b.bname
FROM employee_master e
JOIN branch_master b ON e.branch_id = b.branch_id
WHERE e.dept = 'Admin';

SELECT e.e_name, c.phnno, a.city
FROM employee_master e
INNER JOIN contact_details c ON e.emp_id = c.emp_id
INNER JOIN emp_address_details a ON e.emp_id = a.emp_id;

SELECT e.e_name, c.emailid, c.phnno
FROM employee_master e
LEFT JOIN contact_details c ON e.emp_id = c.emp_id;

DELETE FROM employee_master WHERE emp_id = 'E105';

SELECT e.e_name, c.emailid, c.phnno
FROM employee_master e
RIGHT JOIN contact_details c ON e.emp_id = c.emp_id;

SELECT e.e_name, m.manager_name
FROM employee_master e
LEFT JOIN manager_master m ON e.manager_id = m.manager_id;

SELECT emp_id, e_name, dept, salary, bname
FROM employee_master
NATURAL JOIN branch_master;

SELECT e.e_name, a.city
FROM employee_master e
JOIN branch_master b ON e.branch_id = b.branch_id
JOIN emp_address_details a ON e.emp_id = a.emp_id
WHERE b.bname = 'Vadgaon';

SELECT e.e_name, a.street, a.city
FROM employee_master e
JOIN emp_address_details a ON e.emp_id = a.emp_id
WHERE e.salary > 10000 AND e.branch_id = (
    SELECT branch_id FROM branch_master WHERE bname = 'Vadgaon'
);

SELECT e.e_name, e.emp_id, ea.city AS living_city, ba.city AS working_city
FROM employee_master e
JOIN emp_address_details ea ON e.emp_id = ea.emp_id
JOIN branch_address ba ON e.branch_id = ba.branch_id
WHERE ea.city = ba.city;

SELECT e_name, salary
FROM employee_master
WHERE salary > ALL (
    SELECT salary FROM employee_master WHERE branch_id = (
        SELECT branch_id FROM branch_master WHERE bname = 'Vadgaon'
    )
);

CREATE VIEW total_employee AS
SELECT COUNT(emp_id) AS total_employee_count
FROM employee_master;

SELECT * FROM total_employee;

CREATE OR REPLACE VIEW total_employee AS
SELECT b.bname, COUNT(e.emp_id) AS employee_count_at_branch
FROM employee_master e
JOIN branch_master b ON e.branch_id = b.branch_id
GROUP BY b.bname;

SELECT * FROM total_employee;

SELECT DISTINCT b.bname
FROM branch_master b
JOIN employee_master e ON b.branch_id = e.branch_id
WHERE e.salary > 100000;

CREATE VIEW branch_salary_stats AS
SELECT b.bname, 
       AVG(e.salary) AS average_salary, 
       SUM(e.salary) AS total_salary
FROM employee_master e
JOIN branch_master b ON e.branch_id = b.branch_id
GROUP BY b.bname;

SELECT * FROM branch_salary_stats;

SELECT e_name, dept
FROM employee_master
WHERE branch_id != (
    SELECT branch_id FROM branch_master WHERE bname = 'Vadgaon'
);
